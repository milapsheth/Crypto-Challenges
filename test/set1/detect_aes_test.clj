(ns set1.detect-aes-test
  (:require [set1.detect-aes :as sut]
            [clojure.test :refer :all]
            [clojure.java.io :as io]
            [util.conv :as u]))


(def ciphertexts (with-open [rdr (io/reader (io/file (io/resource "set1/detect_aes.txt")))]
                   (doall (map u/base64-to-byte' (line-seq rdr)))))

(def ecb-encrypted-text '(119 207 52 235 95 123 227 70 188 107 95 91 239 206 52 107 198 183 213 207 53 209 173 221 211 206 184 245 167 251 209 215 52 233 254 31 119 151 118 119 175 92 239 142 28 119 111 55 123 103 93 211 157 159 233 190 184 213 214 223 245 221 117 111 77 248 243 158 54 109 190 123 211 206 184 245 167 251 209 215 52 233 254 31 119 151 118 119 175 92 239 142 28 119 111 55 247 142 249 115 215 95 117 183 53 119 142 185 247 191 120 245 223 92 237 239 54 109 254 90 211 206 184 245 167 251 209 215 52 233 254 31 119 151 118 119 175 92 239 142 28 119 111 55 247 182 189 221 230 155 241 222 154 121 199 121 235 174 60 247 94 120 239 207 90 233 189 55 211 206 184 245 167 251 209 215 52 233 254 31 119 151 118 119 175 92 239 142 28 119 111 55 119 141 55 215 205 28 247 199 60 127 167 91 213 253 154 221 255 92 227 78 52 117 230 244 105 190 117 111 111 125 223 119 246 115 93 183 115 159 55 243 166 244 233 246 218 215 206 154))


(deftest detect-aes-test
  (testing "Failed to detect AES(ECB) encrypted text"
    (is (= ecb-encrypted-text
           ((sut/detect-aes ciphertexts) 0)))))
